<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/assets/styles.css"/>
        <script src="/assets/editor.js"></script>
        <title>Map builder</title>
    </head>
    <body>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-75470442-1', 'auto');
            ga('send', 'pageview');
        </script>
        <h1></h1>
        <div class="map-wrapper">

            <form id="map-form">
                <div><input class="map-title" id="map-title" type="text" required/></div>
                <div id="so">Please enable javascript</div>
                    <!-- map-items - todo import instead -->
                        <pre id="jadehi" style="display:none">

mixin map-item(item, colClass)
    -var classes=[]
    if (item.children.length > 0)
        -classes.push("parent")
    -classes.push(colClass)
    div.map-col(class = classes)&attributes({'data-target': item.id, 'id': "node-" + item.id})
        if (item.children.length > 0)
            div.node-remover(id='nr-' + item.id)="x"
        textarea(class='col-input')&attributes({'data-target': item.id, 'id': "text-" + item.id, 'placeholder':"Placeholder. Add text to keep, leave empty to remove."})=item.text
//adds empty columns so that single items are always under their parent
mixin single-kid(column, kid)
    if (column > 0)
        div.map-col-blank
    if (column > 1)
        div.map-col-blank
    +map-item(kid, 'col-' + column)
    if(column == 1)
        div.map-col-blank
mixin row(children, id, column)
    div.row-wrapper(class='map-row-' + id)
        +lines(column, children.length)
        div.map-row
            +child-cols(children, column)
        +child-rows(children)
mixin child-cols(children, column)
    if (children.length == 1)
        +single-kid(column, children[0])
    else
        each child, index in children
            +map-item(child, 'col-' + index)
mixin child-rows(children)
    each child, index in children
        if child.children.length > 0
            if index == 1 && children.length == 2
                +row(child.children, child.id, 2)
            else
                +row(child.children, child.id, index)
//lines
mixin lines(column, numberOfChildren)
    case column
        when 0
            +left(numberOfChildren)
        when 1
            +middle(numberOfChildren)
        when 2
            +right(numberOfChildren)
mixin right(numberOfChildren)
    case numberOfChildren
        when 1
            +right-one()
        when 2
            +right-two()
        when 3
            +right-three()
mixin middle(numberOfChildren)
    case numberOfChildren
        when 1
            +middle-one()
        when 2
            +middle-two()
        when 3
            +middle-three()
mixin left(numberOfChildren)
    case numberOfChildren
        when 1
            +left-one()
        when 2
            +left-two()
        when 3
            +left-three()

mixin right-three()
    +right-one()
    +three-lines()
mixin right-two()
    +right-one()
    +two-lines()
mixin right-one()
    div.map-lines-row
        div.map-lines.right.single
mixin middle-one()
    div.map-lines-row
        div.map-lines.right
        div.map-lines
mixin middle-two()
    +middle-one()
    +two-lines()
mixin middle-three()
    +middle-one()
    +three-lines()
mixin left-three()
    +left-one()
    +three-lines()
mixin left-two()
    +left-one()
    +two-lines()
mixin left-one()
    div.map-lines-row
        div.map-lines.left.single
mixin two-lines()
    div.map-lines-row
        div.map-lines.top.left
        div.map-lines.top.right
mixin three-lines()
    div.map-lines-row
        div.map-lines.top.left.right
        div.map-lines.top.right
div(class='map-row')
    each option, index in options
        +map-item(option, 'col-' + index)
+child-rows(options)
                        </pre>
                </div>
                <button type='submit' id="save-tree-button">Save</button>
            </form>

        </div>
    </body>
</html>
